<% provide(:head_title, t("my_modules.protocols.head_title", project: h(@project.name), module: h(@my_module.name)).html_safe) %>

<%= render partial: 'shared/drag_n_drop_overlay' %>
<%= render partial: "shared/sidebar", locals: { current_task: @my_module, page: 'task' } %>
<%= render partial: "shared/secondary_navigation", locals: {
  editable: {
    name: 'title',
    active: true,
    width: 'calc(100% - 580px)',
    params_group: 'my_module',
    field_to_udpate: 'name',
    path_to_update: my_module_path(@my_module)
  }
} %>

<div class="content-pane my-modules-protocols-index">
  <%= render partial: "module_header" %>

  <div class="row">
    <div class="col-xs-4">
      <h2 class="protocol-header">
        <%= t("protocols.header.title") %>
        <i class="fas fa-question-circle help_tooltips" data-tooltiplink="<%= I18n.t('tooltips.link.protocol.header') %>" data-tooltipcontent="<%= I18n.t('tooltips.text.protocol.header') %>"></i>
      </h2>
    </div>
  </div>

  <div>
    <div data-role="protocol-status-bar" style="display: inline;">
      <%= render partial: "my_modules/protocols/protocol_status_bar.html.erb" %>
    </div>
    <%= render partial: "my_modules/protocols/protocol_buttons.html.erb" %>
  </div>

  <div class="row">
    <div class="col-xs-12">
      <div class="protocol-description-content">
        <% if can_manage_module?(@my_module) %>
          <%= render partial: "my_modules/protocols/protocol_description_form" %>
        <% elsif @my_module.protocol.description.present? %>
          <%= custom_auto_link(generate_image_tag_from_token(@my_module.protocol.description, @my_module.protocol),
                               simple_format: false,
                               tags: %w(img),
                               team: current_team) %>
        <% else %>
          <%= t('my_modules.protocols.protocol_status_bar.no_description') %>
        <% end %>
      </div>
    </div>
  </div>

  <div data-role="steps-container">
    <%= render partial: "protocols/steps.html.erb" %>
  </div>
</div>

<!-- URL for status bar refreshing -->
<div class="hidden" data-role="protocol-status-bar-url" data-url="<%= protocol_status_bar_protocol_path(@protocol) %>"></div>

<!-- Edit description modal -->
<%= render partial: "my_modules/modals/manage_description_modal" %>

<!-- Edit due date modal -->
<%= render partial: "my_modules/modals/manage_due_date_modal" %>

<!-- Confirm link update modal -->
<%= render partial: "my_modules/protocols/confirm_link_update_modal.html.erb" %>

<!-- Load from repository modal -->
<%= render partial: "my_modules/protocols/load_from_repository_modal.html.erb" %>

<!-- Copy to repository protocol modal -->
<%= render partial: "my_modules/protocols/copy_to_repository_modal.html.erb" %>

<!-- Import protocol elements -->
<%= render partial: "protocols/import_export/import_elements.html.erb" %>

<!-- Complete task modal -->
<%= render partial: 'my_modules/complete_task_modal.html.erb' %>

<%= stylesheet_link_tag 'datatables' %>
<%= javascript_include_tag("my_modules/protocols") %>
